<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta http-eqiv="X-UA-Compatible" content="ie-edge" />	
	<title>Fetch and Graph CSV with Chart.js</title>
	<style>
		h1 {
			color: rgba(255, 70, 70, 1);
			text-align: center;
			margin-top: 30px;
			margin-bottom: 20px;
		}
	</style>
	<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
</head>
<body>
	<h1>Combined Land-Surface Air and Sea-Surface Water Temperature Anomalies in C°</h1>
	<canvas id="chart" width="700" height="350"></canvas>
	<script>
		chartIt();

		async function chartIt () {
			const data = await getData();
			const ctx = document.getElementById('chart').getContext('2d');
			const myChart = new Chart(ctx, {
			    type: 'line',
			    data: {
			        labels: data.xs,
			        datasets: [{
			          label: 'Zonal annual means',
			          data: data.ysZ,
			          fill: false,
			          backgroundColor: 'rgba(255, 50, 50, 0.2)',
			          borderColor: 'rgba(255, 50, 50, 1)',
			          borderWidth: 1
			        },
			        {
			          label: 'Northern Hemisphere',
			          data: data.ysN,
			          fill: false,
			          backgroundColor: 'rgba(132, 99, 255, 0.2)',
			          borderColor: 'rgba(132, 99, 255, 1)',
			          borderWidth: 1
			        },
			        {
			          label: 'Southern Hemisphere',
			          data: data.ysS,
			          fill: false,
			          backgroundColor: 'rgba(99, 255, 132, 0.2)',
			          borderColor: 'rgba(99, 255, 132, 1)',
			          borderWidth: 1
			        },
			        {
			          label: 'Global-mean',
			          data: data.ysG,
			          fill: false,
			          backgroundColor: 'rgba(255, 132, 255, 0.2)',
			          borderColor: 'rgba(255, 132, 132, 1)',
			          borderWidth: 1
			        }
			        ]
			    },
			    options: {
    			    scales: {
    			        yAxes: [{
    			            ticks: {
    			                callback: function(value, index, values) {
    			                    return value + '°';
    			                }
    			            }
    			        }]
    			    }
    			}
			});
		}


		
		// Data from: https://data.giss.nasa.gov/gistemp/
		// Mean from: 

		async function getData() {
			const xs = [];
			const ysZ = [];
			const ysN = [];
			const ysS = [];
			const ysG = [];

			const responseZ =  await fetch('ZonAnn.Ts+dSST.csv');
			const dataZ = await responseZ.text();
			const tableZ = dataZ.split('\n').slice(1);

			const responseN =  await fetch('NH.Ts+dSST.csv');
			const dataN = await responseN.text();
			const tableN = dataN.split('\n').slice(1);

			const responseS =  await fetch('SH.Ts+dSST.csv');
			const dataS = await responseS.text();
			const tableS = dataS.split('\n').slice(1);

			const responseG =  await fetch('GLB.Ts+dSST.csv');
			const dataG = await responseG.text();
			const tableG = dataG.split('\n').slice(1);

			tableZ.forEach(row => {
				const columns = row.split(',');
				const year = columns[0];
				xs.push(year);
				const temp = columns[1];
				ysZ.push(parseFloat(temp) + 14);
				console.log(year, temp);
			});
			tableN.forEach(row => {
				const columns = row.split(',');
				const temp = columns[1];
				ysN.push(parseFloat(temp) + 14);
			});
			tableS.forEach(row => {
				const columns = row.split(',');
				const temp = columns[1];
				ysS.push(parseFloat(temp) + 14);
			});
			tableG.forEach(row => {
				const columns = row.split(',');
				const temp = columns[1];
				ysG.push(parseFloat(temp) + 14);
			});
			return { xs, ysZ, ysN, ysS, ysG };
		}
	</script>
</body>
</html>